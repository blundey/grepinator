![Grepinator](http://dtors.net/grep.png)

Grepinator is a Fail2ban/Crowdsec alternative written entirely in Bash.

This firewall wrapper for ipset and iptables will use the preset filters to generate a list of IP addresses that appear in the logs because of a matched pattern using grep and regex. As an example Grepinator will match on invalid SSH logins and return a list of IP addresses which then get added to a local sqlite3 database. Depending on what options are used, you can choose to just log this attempt or you can block that IP from any further attempts.

IPsets and IPtables are generated by Grepinator. You do not need to configure the firewall manually.

./filters/* directory has some executable filters (scripts) for common services such as sshd/apache2/nginx/bind. The filters will look for common patterns and count occurences of said patterns. if IP is found more than MAX_ATTEMPTS it will get logged/blocked. Template.filter can be used for any additional services you want to grep for patterns on. Filters must remain in the filters directory if you want them to be executed. If you do not want a filter to be executed, remove it from the directory or chmod -x. Errors are surpressed when running filters, so leaving filters there for services that do not exist will not result in an error. You can create any script/executable that returns IP's to be included as a filter for Grepinator to parse to ipset.

./grepinator.sh usage:
```sh
┌──(root💀zombie)-[~/grepinator]
└─# ./grepinator.sh       


   ______                _             __
  / ____/_______  ____  (_)___  ____ _/ /_____  _____
 / / __/ ___/ _ \/ __ \/ / __ \/ __ `/ __/ __ \/ ___/
/ /_/ / /  /  __/ /_/ / / / / / /_/ / /_/ /_/ / /
\____/_/   \___/ .___/_/_/ /_/\__,_/\__/\____/_/
              /_/

Usage : ./grepinator.sh <all|filters|blacklists|log|status|reset>

	all          - Run all filters and blacklists and BLOCK
	daemon       - Run Grepinator in daemon mode (no output)
	filters      - Run filters and BLOCK
	blacklists   - Update and block blacklisted IP's only. Should only be ran once a day
	log          - Run filters and LOG only. (No blocking occurs)
	status [n]   - Show status of whats been blocked. n = number of lines to display
	reset        - Clear the database of logged IP's
	stop         - Stop the daemon
	top [n]      - Show table of blocked IP's in realtime. n = number of lines to display
	version      - Show version

	
┌──(root💀zombie)-[~/grepinator]
└─# ./grepinator.sh all


   ______                _             __
  / ____/_______  ____  (_)___  ____ _/ /_____  _____
 / / __/ ___/ _ \/ __ \/ / __ \/ __ `/ __/ __ \/ ___/
/ /_/ / /  /  __/ /_/ / / / / / /_/ / /_/ /_/ / /
\____/_/   \___/ .___/_/_/ /_/\__,_/\__/\____/_/
              /_/

Grepinating filters...
Number of new attacks found using filters: 0
No IP's to add to ipset. I'll be back..

Number of IP's found in Blacklists: 44805
Added 44805 IP's to Grepinators BL firewall
                                            

	
┌──(root💀zombie)-[~/grepinator]
└─# ./grepinator.sh status 10 


   ______                _             __
  / ____/_______  ____  (_)___  ____ _/ /_____  _____
 / / __/ ___/ _ \/ __ \/ / __ \/ __ `/ __/ __ \/ ___/
/ /_/ / /  /  __/ /_/ / / / / / /_/ / /_/ /_/ / /
\____/_/   \___/ .___/_/_/ /_/\__,_/\__/\____/_/
              /_/

┌─────┬─────────────────────┬─────────────────┬────────┬────────────────────────┬─────────┐
│ ID  │        Date         │       IP        │ Filter │        Location        │ Status  │
├─────┼─────────────────────┼─────────────────┼────────┼────────────────────────┼─────────┤
│ 173 │ 2022-01-18 05:32:14 │ 70.66.140.33    │ sshd   │ CA, Canada             │ Blocked │
│ 172 │ 2022-01-18 03:06:07 │ 161.35.212.214  │ sshd   │ US, United States      │ Blocked │
│ 171 │ 2022-01-18 01:26:12 │ 199.195.248.170 │ sshd   │ US, United States      │ Blocked │
│ 170 │ 2022-01-18 01:11:33 │ 46.101.216.153  │ sshd   │ DE, Germany            │ Blocked │
│ 169 │ 2022-01-17 22:57:55 │ 50.101.199.206  │ sshd   │ CA, Canada             │ Blocked │
│ 168 │ 2022-01-17 21:39:46 │ 82.66.84.2      │ sshd   │ FR, France             │ Blocked │
│ 167 │ 2022-01-17 19:39:07 │ 77.179.79.248   │ sshd   │ DE, Germany            │ Blocked │
│ 166 │ 2022-01-17 19:07:58 │ 189.180.47.62   │ sshd   │ MX, Mexico             │ Blocked │
│ 165 │ 2022-01-17 17:14:04 │ 165.22.84.203   │ sshd   │ DE, Germany            │ Blocked │
│ 164 │ 2022-01-17 10:38:55 │ 220.71.14.244   │ sshd   │ KR, Korea, Republic of │ Blocked │
└─────┴─────────────────────┴─────────────────┴────────┴────────────────────────┴─────────┘

Grepinator Packets Dropped: 85202
Grepinator Blacklists Packets Dropped: 611



                                                           
